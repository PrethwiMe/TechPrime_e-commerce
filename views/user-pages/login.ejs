<%- include('partials/header') %>
<link rel="stylesheet" href="/stylesheets/userLogin.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div class="container-fluid px-5">
  <div class="row min-vh-100 d-flex align-items-center">
    
    <!-- Left Image -->
    <div class="col-lg-6 mb-4">
      <img src="/images/image.PNG" alt="Login Image" class="img-fluid rounded-4 shadow">
    </div>

    <!-- Right Form -->
    <div class="col-lg-6 px-5">
      <div class="login-form">
        <h2 class="fw-bold mb-2">Log in</h2>
        <p class="mb-4">Enter your details below</p>

        <form id="login-form">
          <div class="mb-3">
            <input type="email" name="email" id="email" class="form-control border-0 border-bottom rounded-0" placeholder="Email" >
          </div>

          <div class="mb-3">
            <div class="input-group">
              <input type="password" name="password" id="password" class="form-control border-0 border-bottom rounded-0" placeholder="Password">
              <button class="btn btn-outline-secondary border-0 border-bottom" type="button" id="togglePassword">
                <i class="fas fa-eye" id="toggleIcon"></i>
              </button>
            </div>
          </div>

          <div class="d-flex justify-content-end mb-4">
            <a href="/forgot-password" class="text-danger text-decoration-none">Forget Password?</a>
          </div>

          <div class="d-grid mb-3">
            <button type="submit" class="btn btn-dark">Login</button>
          </div>

          <div class="d-grid mb-4">
            <a href="/auth/google" class="btn btn-outline-dark d-flex align-items-center justify-content-center gap-2 text-decoration-none">
              <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/google/google-original.svg" width="20" alt="Google Icon">
              Sign in with Google
            </a>
          </div>
        </form>

        <p class="text-center">Don't have an account? <a href="/signup" class="text-decoration-none fw-semibold">Sign Up</a></p>
      </div>
    </div>

  </div>
</div>

<%- include('partials/footer') %>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  document.getElementById('login-form').addEventListener('submit', function(e) {
    e.preventDefault();

    // Get form data
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    // Send data to the server via Axios
    axios.post('/login-req', {
      email: email,
      password: password
    })
    .then(function (response) {
      // Show success alert using SweetAlert2
      Swal.fire({
        title: 'Login Successful!',
        text: 'Welcome back!',
        icon: 'success',
        confirmButtonText: 'Okay'
      }).then(() => {
       
        window.location.href = '/';
      });
    })
    .catch(function (error) {
      let errorMessage = 'An error occurred. Please try again.';
      if (error.response && error.response.data && error.response.data.error) {
        errorMessage = error.response.data.error;
      }

      // Show error alert using SweetAlert2
      Swal.fire({
        title: 'Login Failed!',
        text: errorMessage,
        icon: 'error',
        confirmButtonText: 'Try Again'
      });
    });
  });

  // Password toggle functionality
  document.getElementById('togglePassword').addEventListener('click', function() {
    const password = document.getElementById('password');
    const toggleIcon = document.getElementById('toggleIcon');

    if (password.type === 'password') {
      password.type = 'text';
      toggleIcon.classList.remove('fa-eye');
      toggleIcon.classList.add('fa-eye-slash');
    } else {
      password.type = 'password';
      toggleIcon.classList.remove('fa-eye-slash');
      toggleIcon.classList.add('fa-eye');
    }
  });
</script>