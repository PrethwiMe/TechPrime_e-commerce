  <%- include('partials/header') %>


<div class="container my-5">
  <!-- Breadcrumb -->
  <div class="mb-3">
    <small><a href="/">Home</a> / <span>Cart</span></small>
  </div>

  <div class="row">
    <!-- Cart Items -->
    <div class="col-lg-8">
      <% if (cartItems && cartItems.length > 0) { %>
        <% cartItems.forEach(item => { %>
          <div class="d-flex justify-content-between align-items-center border p-3 mb-3 rounded">
            <div class="d-flex align-items-center">
              <!-- Product Image -->
              <img src="<%= item.product.images[0] %>" 
                   alt="<%= item.product.name %>" 
                   style="width:120px; height:100px; object-fit:cover; border-radius:8px; margin-right:15px;">
              <!-- Product Info -->
              <div>
                <h6 class="fw-bold mb-1"><%= item.product.name %></h6>
                <p class="mb-1">Ram : <%= item.product.ram %> Storage : <%= item.product.storage %></p>
                <span class="text-success">In Stock</span>
                <div class="mt-2 d-flex align-items-center">
                  <label class="me-2">Quantity :</label>
                  <select class="form-select form-select-sm w-auto update-qty" 
                          data-id="<%= item._id %>">
                    <% for (let i = 1; i <= 10; i++) { %>
                      <option value="<%= i %>" <%= i === item.quantity ? 'selected' : '' %>>
                        <%= i.toString().padStart(2, '0') %>
                      </option>
                    <% } %>
                  </select>
                </div>
              </div>
            </div>

            <!-- Price & Remove -->
            <div class="text-end">
              <p class="mb-1 fw-bold">Price ₹<%= item.product.finalPrice.toLocaleString() %></p>
              <% if (item.product.discount) { %>
                <p class="text-danger small mb-2"><%= item.product.discount %>% off</p>
              <% } %>
              <button class="btn btn-dark btn-sm remove-item" data-id="<%= item._id %>">Remove</button>
            </div>
          </div>
        <% }) %>

        <hr>
        <div class="d-flex justify-content-end fw-bold">
          Total : ₹<%= cartTotal.toLocaleString() %>
        </div>
      <% } else { %>
        <div class="alert alert-info">Your cart is empty</div>
      <% } %>
    </div>

    <!-- Cart Total -->
    <div class="col-lg-4">
      <div class="border rounded p-3 shadow-sm">
        <h5 class="fw-bold mb-3">Cart Total</h5>
        <div class="d-flex justify-content-between mb-2">
          <span>Subtotal:</span>
          <span>₹<%= cartTotal.toLocaleString() %></span>
        </div>
        <div class="d-flex justify-content-between mb-2">
          <span>Shipping:</span>
          <span class="text-success">Free</span>
        </div>
        <hr>
        <div class="d-flex justify-content-between fw-bold mb-3">
          <span>Total:</span>
          <span>₹<%= cartTotal.toLocaleString() %></span>
        </div>
        <a href="/checkout" class="btn btn-danger w-100">Proceed to checkout</a>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>

<script>
  // Update quantity
  document.querySelectorAll('.update-qty').forEach(select => {
    select.addEventListener('change', function() {
      const id = this.dataset.id;
      const qty = this.value;
      fetch(`/cart/update/${id}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ quantity: qty })
      }).then(() => location.reload());
    });
  });

  // Remove item
  document.querySelectorAll('.remove-item').forEach(btn => {
    btn.addEventListener('click', function() {
      const id = this.dataset.id;
      fetch(`/cart/remove/${id}`, { method: 'POST' })
        .then(() => location.reload());
    });
  });
</script>
